<?xml version="1.0"?>
<!--
    VirtualBox Windows Installation Script (WiX)

    Copyright (C) 2006-2014 Oracle Corporation

    This file is part of VirtualBox Open Source Edition (OSE), as
    available from http://www.virtualbox.org. This file is free software;
    you can redistribute it and/or modify it under the terms of the GNU
    General Public License (GPL) as published by the Free Software
    Foundation, in version 2 as it comes in the "COPYING" file of the
    VirtualBox OSE distribution. VirtualBox OSE is distributed in the
    hope that it will be useful, but WITHOUT ANY WARRANTY of any kind.
-->

<?include Properties.wxi ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:difxapp="http://schemas.microsoft.com/wix/DifxAppExtension">

    <!-- Note: GUIDs in WiX *must* be uppercase! -->
    <!-- Always include an upgrade ID or otherwise upgrade installation will not be possible. When doing
         a major upgrade (more than just fixing a few files) change the product GUID. We always do a major
         upgrade even for minor VBox updates. For that only change the product ID and the product version.
         The upgrade code *never* must be changed! -->

    <!-- Update / Upgrade policies:
         Update Type    Package Code    Product Version     Product Code    Upgrade Code
         Small update   change          don't change        don't change    don't change
         Minor update   change          change              don't change    don't change
         Major upgrade  change          change              change          don't change -->

    <!-- Old product ID: <Product Id="B59FE77B-738F-4f1c-AB48-3104895AF676"
         Old upgrade code of innotek: UpgradeCode="F5FFAEBF-97AE-4038-8F91-4DE719456127" -->

    <Module Id="msm_VBoxUSB"
            Language="!(loc.LANG)"
            Version="$(var.Property_Version)">

        <Package Id="b8f1b6f4-2e92-40a6-b819-782e523b20ab"
                 Keywords="Installer, Setup"
                 Description="$(env.VBOX_PRODUCT) $(var.Property_VersionExt) USB drivers installation package"
                 Comments="$(env.VBOX_PRODUCT) USB drivers installation package"
                 Manufacturer="$(env.VBOX_VENDOR)"
                 InstallerVersion="200"
                 AdminImage="yes"
                 InstallPrivileges="elevated"
                 Platform="$(var.Property_Platform)"
                 SummaryCodepage="1252"/>

        <!-- Here comes the file/directory list -->
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="MergeRedirectFolder" FileSource=".">

                <Directory Id="dir_USBFilter" Name="filter">
                    <Component Id="cp_USBFilterDriver" Guid="B7D782D2-96DF-4775-A0E1-A76CF7B04B65" Win64="$(var.Property_Win64)">
                        <difxapp:Driver AddRemovePrograms="no" ForceInstall="yes"
                                        Legacy="$(var.Property_DriverLegacy)" Sequence="0" PlugAndPlayPrompt="no"/>
                        <File Id="file_VBoxUSBMon.sys" Name="VBoxUSBMon.sys"
                              Source="$(env.PATH_OUT)\bin\VBoxUSBMon.sys" />
                        <File Id="file_VBoxUSBMon.inf" Name="VBoxUSBMon.inf"
                              Source="$(env.PATH_OUT)\bin\VBoxUSBMon.inf" />
<?if $(env.VBOX_SIGNING_MODE) != none ?>
                        <File Id="file_VBoxUSBMon.cat" Name="VBoxUSBMon.cat"
                              Source="$(env.PATH_OUT)\bin\VBoxUSBMon.cat" />
<?endif ?>
                    </Component>
                </Directory>

                <Directory Id="dir_USBDevice" Name="device">
                    <Component Id="cp_USBDeviceDriver" Guid="010FE46A-E358-43E2-8BDC-38BC8BEC82E0" Win64="$(var.Property_Win64)">
                        <!-- <difxapp:Driver AddRemovePrograms="no" ForceInstall="yes"
                                        Legacy="$(var.Property_DriverLegacy)" Sequence="0" PlugAndPlayPrompt="no"/> -->
                        <File Id="file_VBoxUSB.sys" Name="VBoxUSB.sys"
                              Source="$(env.PATH_OUT)\bin\VBoxUSB.sys" />
                        <File Id="file_VBoxUSB.inf" Name="VBoxUSB.inf"
                              Source="$(env.PATH_OUT)\bin\VBoxUSB.inf" />
<?if $(env.VBOX_SIGNING_MODE) != none ?>
                        <File Id="file_VBoxUSB.cat" Name="VBoxUSB.cat"
                              Source="$(env.PATH_OUT)\bin\VBoxUSB.cat" />
<?endif ?>
                    </Component>
                </Directory>

            </Directory> <!-- MergeRedirectFolder -->
        </Directory> <!-- TARGETDIR -->

    </Module>
</Wix>
